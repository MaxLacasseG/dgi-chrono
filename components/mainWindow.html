<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta http-equiv="X-UA-Compatible" content="ie=edge" />
		<link
			rel="stylesheet"
			href="https://use.fontawesome.com/releases/v5.8.2/css/all.css"
			integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay"
			crossorigin="anonymous"
		/>
		<link
			rel="stylesheet"
			href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
			integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
			crossorigin="anonymous"
		/>
		<link rel="stylesheet" href="../assets/css/styles.css" />
		<title>Pince moi ça!</title>
		<style>
			.titleBox {
				-webkit-user-select: none;
				-webkit-app-region: drag;
			}
		</style>
	</head>
	<body>
		<main>
			<div class="logoBox"></div>
			<div class="titleBox">
				<h1 class="title">
					Pince-moi ça!
				</h1>
				<h2 id="cycleBox"></h2>
			</div>
			<div class="main-container">
				<div class="chronoContainer">
					<div class="time">
						<p></p>
					</div>
					<div class="controles">
						<div class="controles-btn" id="ctrl-reset">
							<i class="fas fa-history"></i>
						</div>
						<div class="controles-btn hide" id="ctrl-pause">
							<i class="fas fa-pause-circle"></i>
						</div>
						<div class="controles-btn" id="ctrl-start">
							<i class="fas fa-play-circle"></i>
						</div>
					</div>
				</div>
				<div class="pointsContainer">
					<div class="points">
						<p></p>
					</div>
					<div class="controles">
						<div class="row">
							<div class="controles-btn green" id="ctrl-green">
								<i class="fas fa-arrow-up "></i>
							</div>
							<div class="controles-btn" id="ctrl-mystery">
								<i class="fas fa-question"></i>
							</div>
						</div>
						<div class="row">
							<div class="controles-btn blue" id="ctrl-blue">
								<i class="fas fa-arrow-left "></i>
							</div>
							<div class="controles-btn yellow" id="ctrl-yellow">
								<i class="fas fa-arrow-down "></i>
							</div>
							<div class="controles-btn red" id="ctrl-red">
								<i class="fas fa-arrow-right "></i>
							</div>
						</div>
					</div>
				</div>
			</div>
		</main>
		<!-- SCRIPTS -->
		<script>
			const {ipcRenderer} = require("electron");
			const Chrono = require("../assets/js/chrono");
			Chrono.initCounter();

			//SAVE ELEMENTS

			const timeBlock = document.querySelector(".time p");
			const chronoContainer = document.querySelector(".chronoContainer");
			const ctrls = document.querySelectorAll(".controles-btn");
			const startBtn = document.querySelector("#ctrl-start");
			const resetBtn = document.querySelector("#ctrl-reset");
			const pauseBtn = document.querySelector("#ctrl-pause");

			const pointsBlock = document.querySelector(".points p");
			const greenBtn = document.querySelector("#ctrl-green");
			const blueBtn = document.querySelector("#ctrl-blue");
			const yellowBtn = document.querySelector("#ctrl-yellow");
			const redBtn = document.querySelector("#ctrl-red");
			const mysteryBtn = document.querySelector("#ctrl-mystery");

			const switchCycle = cycle => {
				console.log("Switch", cycle);

				const cycleBox = document.querySelector("#cycleBox");
				cycleBox.innerText = cycle === 1 ? "1er cycle" : "2e-3e cycle";
			};
			//ELEMENTS LISTENERS
			startBtn.addEventListener("animationstart", e => {
				startBtn.addEventListener("animationend", e => {
					startBtn.classList.remove("animate");
					startBtn.classList.add("hide");
					pauseBtn.classList.remove("hide", "animate");
				});
			});

			pauseBtn.addEventListener("animationstart", e => {
				pauseBtn.addEventListener("animationend", e => {
					pauseBtn.classList.remove("animate");
					pauseBtn.classList.add("hide");
					startBtn.classList.remove("hide", "animate");
				});
			});

			resetBtn.addEventListener("animationstart", e => {
				resetBtn.addEventListener("animationend", e => {
					resetBtn.classList.remove("animate");
					pauseBtn.classList.add("hide");
					startBtn.classList.remove("hide", "animate");
				});
			});

			startBtn.addEventListener("click", () => {
				startBtn.classList.add("animate");
				Chrono.startCounter();
			});

			pauseBtn.addEventListener("click", () => {
				pauseBtn.classList.add("animate");
				Chrono.stopCounter();
			});

			resetBtn.addEventListener("click", () => {
				Chrono.resetCounter();
				switchCycle(Chrono.state.cycle);
				chronoContainer.classList.remove("animate");
				resetBtn.classList.add("animate");

				redBtn.classList.remove("hide");
				blueBtn.classList.remove("hide");
				yellowBtn.classList.remove("hide");
				greenBtn.classList.remove("hide");
				mysteryBtn.classList.remove("hide");
			});

			greenBtn.addEventListener("click", () => {
				Chrono.addPoints(50);
			});
			blueBtn.addEventListener("click", () => {
				Chrono.addPoints(10);
			});
			yellowBtn.addEventListener("click", () => {
				Chrono.addPoints(20);
			});
			redBtn.addEventListener("click", () => {
				Chrono.addPoints(30);
			});
			mysteryBtn.addEventListener("click", () => {
				Chrono.addPoints(40);
			});

			var sound = function(src) {
				this.sound = document.createElement("audio");
				this.sound.src = src;
				this.sound.setAttribute("preload", "auto");
				this.sound.setAttribute("controls", "none");
				this.sound.style.display = "none";
				document.body.appendChild(this.sound);
				this.play = function() {
					this.sound.play();
				};
				this.stop = function() {
					this.sound.pause();
				};
			};

			//GLOBAL EVENTS
			ipcRenderer.on("chrono:set-time", (e, time) => {
				if (time <= 5) {
					chronoContainer.classList.add("animate");
				}
				switchCycle(Chrono.state.cycle);
				timeBlock.innerText = time + " s";
			});
			ipcRenderer.on("chrono:set-points", (e, points) => {
				pointsBlock.innerText = points + " pts";
			});
			ipcRenderer.on("chrono:time-ended", (e, time) => {
				startBtn.classList.remove("hide", "animate");
				pauseBtn.classList.add("hide");
				redBtn.classList.add("hide");
				blueBtn.classList.add("hide");
				yellowBtn.classList.add("hide");
				greenBtn.classList.add("hide");
				mysteryBtn.classList.add("hide");
				chronoContainer.classList.remove("animate");
				timeBlock.innerText = "FIN";

				var sound = document.createElement("audio");
				sound.src =
					Chrono.state.soundIndex === 1
						? "../assets/audio/wouf.mp3"
						: "../assets/audio/bateau.mp3";
				sound.setAttribute("preload", "auto");
				sound.setAttribute("controls", "none");
				sound.style.display = "none";
				document.body.appendChild(sound);
				sound.play();
			});

			ipcRenderer.on("chrono:edit-time", (e, newTime) => {
				Chrono.state.duration = newTime.values;
				Chrono.setDurationIndex(0);
				chronoContainer.classList.remove("animate");
				Chrono.resetCounter();
			});

			ipcRenderer.on("controls:toggle", e => {
				if (Chrono.state.timeEnded) {
					resetBtn.click();
					return;
				}
				if (!Chrono.state.isCounting) {
					startBtn.click();
				} else {
					pauseBtn.click();
				}
			});

			ipcRenderer.on("controls:switchCycle", (e, cycle) => {
				switchCycle(cycle);
				Chrono.setCycle(cycle);
				chronoContainer.classList.remove("animate");
			});

			ipcRenderer.on("controls:switchSound", (e, soundIndex) => {
				console.log(soundIndex);

				Chrono.setSound(soundIndex);
			});

			ipcRenderer.on("controls:reset", (e, time) => {
				switchCycle(Chrono.state.cycle);
				resetBtn.click();
			});

			ipcRenderer.on("controls:addPoints", (e, points) => {
				Chrono.addPoints(points);
			});
		</script>
		<script
			src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
			integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
			crossorigin="anonymous"
		></script>
		<script
			src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
			integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
			crossorigin="anonymous"
		></script>
		<script
			src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
			integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
			crossorigin="anonymous"
		></script>
	</body>
</html>
